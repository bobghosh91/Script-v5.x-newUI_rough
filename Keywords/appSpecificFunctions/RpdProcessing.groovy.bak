package appSpecificFunctions

import static com.kms.katalon.core.checkpoint.CheckpointFactory.findCheckpoint
import static com.kms.katalon.core.testcase.TestCaseFactory.findTestCase
import static com.kms.katalon.core.testdata.TestDataFactory.findTestData
import static com.kms.katalon.core.testobject.ObjectRepository.findTestObject

import com.kms.katalon.core.annotation.Keyword
import com.kms.katalon.core.checkpoint.Checkpoint
import com.kms.katalon.core.cucumber.keyword.CucumberBuiltinKeywords as CucumberKW
import com.kms.katalon.core.mobile.keyword.MobileBuiltInKeywords as Mobile
import com.kms.katalon.core.model.FailureHandling
import com.kms.katalon.core.testcase.TestCase
import com.kms.katalon.core.testdata.TestData
import com.kms.katalon.core.testobject.TestObject
import com.kms.katalon.core.webservice.keyword.WSBuiltInKeywords as WS
import com.kms.katalon.core.webui.driver.DriverFactory
import com.kms.katalon.core.webui.keyword.WebUiBuiltInKeywords as WebUI
import org.openqa.selenium.JavascriptExecutor

import internal.GlobalVariable

public class RpdProcessing {

	String rpdJsStmt = "var callback = arguments[arguments.length - 1]; AE.provisional.design.serialize({toJSON: true}, i_oDesignData => callback(i_oDesignData));"

	/**
	 * Retrieve Catalogs Json content as String.
	 */
	@Keyword
	def String getCatalogsJsonAsString(){

		JavascriptExecutor js = (JavascriptExecutor) DriverFactory.getWebDriver()

		def rpdJsonBuilderObj = new groovy.json.JsonBuilder(js.executeAsyncScript(rpdJsStmt))
		def slurper = new groovy.json.JsonSlurper()
		def rpdJsonSlurpedObject = slurper.parseText(rpdJsonBuilderObj.toString())

		def catalogsRpdJsonBuilderObj = new groovy.json.JsonBuilder(rpdJsonSlurpedObject.Catalogs)

		return (catalogsRpdJsonBuilderObj.toString())
	}

	/**
	 * Retrieve Default FOState from Catalogs Json content as String.
	 */
	@Keyword
	def String getDefaultFOStateFromCatalogsJsonAsString(){

		JavascriptExecutor js = (JavascriptExecutor) DriverFactory.getWebDriver()

		def rpdJsonBuilderObj = new groovy.json.JsonBuilder(js.executeAsyncScript(rpdJsStmt))
		def slurper = new groovy.json.JsonSlurper()
		def rpdJsonSlurpedObject = slurper.parseText(rpdJsonBuilderObj.toString())

		def catalogsRpdJsonBuilderObj = new groovy.json.JsonBuilder(rpdJsonSlurpedObject.Catalogs)
		def catalogsRpdJsonSlurpedObj = slurper.parseText(catalogsRpdJsonBuilderObj.toString())

		//println (catalogsRpdJsonSlurpedObj.toString())
		//println (catalogsRpdJsonSlurpedObj.DefaultFOState)

		String defaultFOState = ""

		for (Object o : catalogsRpdJsonSlurpedObj) {

			//println (o.toString())
			//println (o.getClass())

			if (o.getValue().toString().contains("DefaultFOState")) {

				//println o.getValue()
				//println o.getValue().getClass()
				//println o.getValue().get("DefaultFOState")

				defaultFOState = (new groovy.json.JsonBuilder(o.getValue().get("DefaultFOState"))).toString()
				break
			}
		}

		//println defaultFOState
		return defaultFOState
	}

	/**
	 * Retrieve entire RPD content as String.
	 */
	@Keyword
	def String getEntireJsonAsString(){

		JavascriptExecutor js = (JavascriptExecutor) DriverFactory.getWebDriver()

		def rpdJsonBuilderObj = new groovy.json.JsonBuilder(js.executeAsyncScript(rpdJsStmt))
		return (rpdJsonBuilderObj.toString())
	}

	/**
	 * Retrieve Products content as String.
	 */
	@Keyword
	def String getProductsJsonAsString(){

		JavascriptExecutor js = (JavascriptExecutor) DriverFactory.getWebDriver()

		def rpdJsonBuilderObj = new groovy.json.JsonBuilder(js.executeAsyncScript(rpdJsStmt))
		def slurper = new groovy.json.JsonSlurper()
		def rpdJsonSlurpedObject = slurper.parseText(rpdJsonBuilderObj.toString())

		def productsRpdJsonBuilderObj = new groovy.json.JsonBuilder(rpdJsonSlurpedObject.Products)

		return (productsRpdJsonBuilderObj.toString())
	}

	/**
	 * Retrieve Items content as String.
	 */
	@Keyword
	def String getItemsJsonAsString(){

		JavascriptExecutor js = (JavascriptExecutor) DriverFactory.getWebDriver()

		def rpdJsonBuilderObj = new groovy.json.JsonBuilder(js.executeAsyncScript(rpdJsStmt))
		def slurper = new groovy.json.JsonSlurper()
		def rpdJsonSlurpedObject = slurper.parseText(rpdJsonBuilderObj.toString())

		def itemsRpdJsonBuilderObj = new groovy.json.JsonBuilder(rpdJsonSlurpedObject.Items)

		return (itemsRpdJsonBuilderObj.toString())
	}

	/**
	 * Retrieve Viewing Properties content as String.
	 */
	@Keyword
	def String getViewingPropertiesJsonAsString(){

		JavascriptExecutor js = (JavascriptExecutor) DriverFactory.getWebDriver()

		def rpdJsonBuilderObj = new groovy.json.JsonBuilder(js.executeAsyncScript(rpdJsStmt))
		def slurper = new groovy.json.JsonSlurper()
		def rpdJsonSlurpedObject = slurper.parseText(rpdJsonBuilderObj.toString())

		def viewingPropertiesRpdJsonBuilderObj = new groovy.json.JsonBuilder(rpdJsonSlurpedObject.ViewingProps)

		return (viewingPropertiesRpdJsonBuilderObj.toString())
	}

	/**
	 * Retrieve Version as String.
	 */
	@Keyword
	def String getVersionAsString(){

		JavascriptExecutor js = (JavascriptExecutor) DriverFactory.getWebDriver()

		def rpdJsonBuilderObj = new groovy.json.JsonBuilder(js.executeAsyncScript(rpdJsStmt))
		def slurper = new groovy.json.JsonSlurper()
		def rpdJsonSlurpedObject = slurper.parseText(rpdJsonBuilderObj.toString())

		def versionOfRpdJsonBuilderObj = new groovy.json.JsonBuilder(rpdJsonSlurpedObject.Version)

		return (versionOfRpdJsonBuilderObj.toString())
	}

	/**
	 * Retrieve Products Count
	 */
	@Keyword
	def int getProductsCount(){

		JavascriptExecutor js = (JavascriptExecutor) DriverFactory.getWebDriver()

		def rpdJsonBuilderObj = new groovy.json.JsonBuilder(js.executeAsyncScript(rpdJsStmt))
		def slurper = new groovy.json.JsonSlurper()
		def rpdJsonSlurpedObject = slurper.parseText(rpdJsonBuilderObj.toString())

		int count = 0
		for (def product : rpdJsonSlurpedObject.Products) {

			//println (product)
			count = count + 1
		}

		//println ("Total Products: " + count)
		return count
	}

	/**
	 * Retrieve Items Count
	 */
	@Keyword
	def int getItemsCount(){

		JavascriptExecutor js = (JavascriptExecutor) DriverFactory.getWebDriver()

		def rpdJsonBuilderObj = new groovy.json.JsonBuilder(js.executeAsyncScript(rpdJsStmt))
		def slurper = new groovy.json.JsonSlurper()
		def rpdJsonSlurpedObject = slurper.parseText(rpdJsonBuilderObj.toString())

		int count = 0
		for (def item : rpdJsonSlurpedObject.Items) {

			//println (item)
			count = count + 1
		}

		println ("Total Items: " + count)
		return count
	}

	/**
	 * Retrieve Individual Product Information Json Count, based on RPD Identifier Key For Product Section
	 */
	@Keyword
	def String getProductInformationAsStringFromRpdProductKey (String rpdIdentifierKeyForProductSection){

		JavascriptExecutor js = (JavascriptExecutor) DriverFactory.getWebDriver()

		def rpdJsonBuilderObj = new groovy.json.JsonBuilder(js.executeAsyncScript(rpdJsStmt))
		def slurper = new groovy.json.JsonSlurper()
		def rpdJsonSlurpedObject = slurper.parseText(rpdJsonBuilderObj.toString())

		String individualProductInformationAsString = ""

		for (def product : rpdJsonSlurpedObject.Products) {

			if (product.getKey().toString().equals(rpdIdentifierKeyForProductSection)) {

				individualProductInformationAsString = product.getValue().toString()
				//println individualProductInformationAsString
				break
			}
		}

		return individualProductInformationAsString
	}

	//	/**
	//	 * Retrieve Individual Product Information Json Count, based on product code
	//	 */
	//	@Keyword
	//	def ArrayList<String> getProductInformationAsStringFromProductCode (String productCode){
	//
	//		JavascriptExecutor js = (JavascriptExecutor) DriverFactory.getWebDriver()
	//
	//		def rpdJsonBuilderObj = new groovy.json.JsonBuilder(js.executeAsyncScript(rpdJsStmt))
	//		def slurper = new groovy.json.JsonSlurper()
	//		def rpdJsonSlurpedObject = slurper.parseText(rpdJsonBuilderObj.toString())
	//
	//		ArrayList <String> productInformationList = new ArrayList <String> ()
	//
	//		for (def product : rpdJsonSlurpedObject.Products) {
	//
	//
	//			println product
	//
	//			def slurperProductInfo = new groovy.json.JsonSlurper()
	//			def productInfoSlurpedObject = slurper.parseText(product.getValue().toString())
	//
	//			if (productInfoSlurpedObject.Code.toString().equals(productCode)) {
	//
	//				productInformationList.add(product.getValue().toString())
	//			}
	//		}
	//
	//		return productInformationList
	//	}
}
